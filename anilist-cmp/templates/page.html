<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Anilist common anime tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ description }}">

    <!-- preload the first five images, lazy load the rest -->
    {% for entry in itertools.islice(entries, 5) %}
        <link rel="preload" as="image" href="{{ entry['coverImage']['medium'] }}" crossorigin>
    {% endfor %}
</head>
<body>
<table>
    <button data-column="romaji">Toggle Romaji</button>
    <button data-column="english">Toggle English</button>
    <button data-column="native">Toggle Native</button>
    <thead>
    <tr>
        <th>Cover</th>
        <th>Romaji</th>
        <th>English</th>
        <th>Native</th>
    </tr>
    </thead>
    <colgroup>
        <col>
        <col id="romaji">
        <col id="english">
        <col id="native">
    </colgroup>
    <tbody>
    {% for index, entry in enumerate(entries) %}
        <tr>
            <td><a href="{{ entry['siteUrl'] }}"><img loading="{{ 'eager' if index < 5 else 'lazy' }}"
                                                      src="{{ entry['coverImage']['medium'] }}"
                                                      alt="Cover for '{{ entry['title']['romaji'] }}'"></a></td>
            <td>{{ entry['title']['romaji'] }}</td>
            <td>{{ entry['title']['english'] }}</td>
            <td>{{ entry['title']['native'] }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</body>
<script>
    const toggles = document.querySelectorAll('button');

    const toggle_setting = (setting) => {
        if (localStorage.getItem(setting)) {
            localStorage.removeItem(setting);
            document.getElementById(setting).style.removeProperty('visibility');
        } else {
            localStorage.setItem(setting, '1')
            document.getElementById(setting).style.setProperty('visibility', 'collapse');
        }
    }

    toggles.forEach(button => {
        button.addEventListener('click', () => toggle_setting(button.dataset.column))
    })

    for (const column of ['romaji', 'english', 'native'])
        if (localStorage.getItem(column))
            document.getElementById(column).style.setProperty('visibility', 'collapse');
</script>
</html>
